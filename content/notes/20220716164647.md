+++
title = "📝MMbot"
lastmod = 2022-08-14T07:18:47+09:00
tags = ["WIKI"]
draft = false
+++

[🔖仮想通貨Bot手法]({{< relref "20220603152137.md#73d718cb-a2fb-4add-8d46-41485ffc4db1" >}})


## mmbotとは {#bb4c5a}

market making bot. [📝マーケットメイク]({{< relref "20220716165800.md" >}})戦略を[📝仮想通貨Bot]({{< relref "20220603152137.md" >}})に適用.

ネット記事やTwitterでは[📝高頻度bot]({{< relref "20220716131618.md" >}})はMMbotの意味で使われていることが多いがmmbotは高頻度botの部分であり全てではないことに注意.


### mmbotの利益の仕組み {#adaec9}

簡単に言うと, 手動で売買したい人の成行注文を刈る.

ビットコインを買う場合, 販売所と取引所があり, 普通の人は販売所は手数料が高いので取引所をできれば使いたいのだ. しかし, 取引所というのは交換によって売買するため, そもそも売っている人がいないと買うこともできない.

そこでbotは買いたいひとに対してあらかじめ指値で注文を出すことによって板に注文を並べておくことによって一般人から成行注文で買ってもらうことを待つ. この時, 実際の値段よりもちょっと高く売りに出すことが大事でこれが利益の厳選になる. ビットコインをすぐ買いたいけど販売所の手数料が嫌な人が販売所よりも安いならば若干の損でもbotの注文を買ってくれる.

botは安く買って高く売れればそれが利益になるが, このマーケットメイクのうまいところは, あらかじめ売りと買いの両方に注文を出して売りたい人と買いたい人の両方を相手にすること.

これをすることで, 安く買う -> 高く売るということをやろうとしたときに, 買ってから売るという順番ではなくて, 買いつつ売るというような状況になり, 結果２倍の速度で１サイクルを回すことができる. ここがマーケットメイクの秀逸点.

仮に同時行わないとする, 例えば高く売ることに成功すると, JPYの残高は増え, BTCの残高は減る. このあとさらにもう一度BTC高く売るためにはどこかからJPYでBTCを買ってBTCを安く仕入れる必要がある.


### mmbotの特徴 {#10556b}

初心者には優しい.

-   pros.
    -   リスクが少なくコツコツ稼げる.
    -   少資金から高い利回りを達成できる.
-   cons.
    -   ある程度稼げるとスケールしない.
    -   複利運用ができない([高頻度取引の限界](#71241834-e7d7-4075-8714-87659a971b0e)).
    -   取引手数料無料かつtakerが多い環境でしか利益を上げづらい戦略.

市場選びがとても重要. 稼げない市場では稼げない. bitFlyerが特に有名なのはmmbotの特徴によるかも.


### mmbot戦略 {#e5f11b}

既存戦略は大きく分けて, Effecitive Spread予測と在庫管理の２つに分類できる.

-   [Effective Spread予測](#3678dded-21c0-4333-bec1-4b5ea00e924b)
    -   機械学習による予測
    -   投資指標による予測
    -   板情報と注文量からの予測..
-   在庫管理
    -   片張り解消
    -   損切り戦略
    -   資金管理
    -   並列実行/ポジション管理


## Effective Spread予測 {#3678dded-21c0-4333-bec1-4b5ea00e924b}

[Effective spread]({{< relref "20220716193437.md#e1befe97-d60e-4a3e-89f7-c8c9e38eac8e" >}})を仮想通貨の文脈で予測する戦略.

アクティブスプレッド予測はトレンドに弱く, 投資指標戦略はトレンドに強い.

実効価格(effective), 指値を入れる基準値. 対義語として最良価格(best).

通常表示されたり取得できる値は最良(best)価格と言われ, この値を成行注文で指定する. [📝マーケットメイク]({{< relref "20220716165800.md" >}})の場合, 一方指値注文では自分で価格を指定する必要がある. この指値注文での指定価格は取得した板情報から計算で算出する.

これをすることによって, 注文数の少なさ(板の薄さ)や注文量の多さによるスリッページを軽減することができる.

---

現在のスプレッドよりも, 未来のスプレッドの動きを予測してそれに対して注文をかける. 以下のリンクがわかりやすかった.

> ;; <https://note.com/akaness_note/n/n3c816e051f8c>
>
> これがもし次のt秒間で100150円から100450円の間まで変動すると予測出来たらどうでしょうか。100449円ショートと100151円ロングで差額298円となり単純に最良価格の間に挟むよりも利益が大きくなります。
>
> 歩み値や板情報等の分析を行い、このアクティブスプレッドを予測することがこの戦略の要であり、予測精度の高さがそのまま利益に直結すると言えるでしょう。


### Effective bid-ask spread {#aada46}

たとえばこの論文だとeffective bid-ask spreadという用語が使われている.

-   [Bias in the effective bid-ask spread - ScienceDirect](https://www.sciencedirect.com/science/article/pii/S0304405X21001458)

中身よくみてないけど2021年のやつということで面白そうだな. これとその参考文献を追っていけば深堀できそう.


### まささんmmbotまとめ {#f56266}

ref. <https://twitter.com/i/events/1015960962959069184>

> まず、十分に短い期間では「価格はある値を中心に、ある価格帯をランダムに行ったり来たりする」と仮定できます。ボリンジャーバンドに近しい。なので狙いは、その行ったり来たりの値幅でどんどん売り買いすること。「ある値」を上回れば売り注文、下回れば買い注文。
>
> 期間が短いほどこの仮定は適用しやすいから、超高頻度で取引。で、「その価格帯の値幅を適切に推定する」ことが肝になりますよね。トレンドがなく一定の幅を往復するだけなら、これでどんどん儲けられます。価格ボラの大きさと、板の厚さ＆成行注文量から幅を推定できるらしい

> 「その価格帯の値幅を適切に推定する」ことが肝になりますよね.

つまり, アクティブスプレッドを予測することがキモ. 板の端の値は見かけ上の虚構の値であり, 意図的になにかを仕掛けているのであり, それが取引全体の最適な値ではない. 予測に対して機械学習をつかったりルールベースでアルゴリズムから算出したり.


### 投資指標戦略 {#2f9bf6}

とある投資指標に従い指値を入れる方向を決め、反転時までの値幅を利益とする戦略. mmbotだけではなく、5分足や1時間足の時間軸でも多く用いられているもの.

この指標を機械学習で探すのが[📝MMbot]({{< relref "20220716164647.md" >}}).


## 在庫管理 {#ec52e9}


### 片張り対応 {#c4d035}

片張りとは, 売り/買いのどちらかが約定し片方が残る事. mmbotでは両建てが基本のためよく直面する. 売りと買いのそれぞれの注文が同時に決済されるわけではない.

片方残った場合,

-   価格が戻るまで待つ(どれくらいの時間か).
-   指値update
    -   未約定オーダーをキャンセル後約定したオーダーに対し指値注文で反対売買.
    -   未約定のオーダーをキャンセル後同方向に指値注文を再度送信する.
-   成行注文で手仕舞いする
    -   損切りのタイミングを見極める.
    -   片方だけ約定したものを成行で処理.
    -   片方だけ約定できなかったものを成行で注文.
-   片張り中にチャンスがあったら次の売買はするかしないか.
    -   するならマルチスレッドで対応.

---

-   [bitFlyerでMMbotを作ってみた結果、在庫管理は利益出すために必須！ | 矢野テックの投資ブログ](https://investment-vmoney.com/archives/5173)
-   [mmbotを何種類か作った時のメモ書き｜あかネス｜note](https://note.com/akaness_note/n/n3c816e051f8c)
-   [onSingleLeg · bitz+rinjani/r2 · GitHub](https://github.com/bitrinjani/r2/blob/master/docs/CONFIG_JP.md#onsingleleg%E8%A8%AD%E5%AE%9A%E8%A9%B3%E7%B4%B0)
-   [片方が約定しなかった場合の成行注文によるヘッジ機能の追加 bitrinjani/r2](https://github.com/bitrinjani/r2/issues/7)


### まささんmmbotまとめ {#f56266}

なるほどmmbotのキモは在庫管理.

ref. <https://twitter.com/i/events/1015960962959069184>

> ただ、トレンドが発生するとその仮定が崩れ、「在庫」を抱えてしまいます。買ったけど価格が戻らずに売れないとか。在庫は処分しなきゃです。積極的に処分すると、一回ごとの損失は減るけど、勝率も減る。抱えすぎても逆に問題。要はトレードオフです。
>
> この「在庫をどれだけ抱えてよいか」を最適化するのがMM戦略の肝のようです。それは「リスク回避度」と呼ばれ、小さいほど①推定した価格帯の値幅よりも狭めの幅で売り買い注文を繰り返す、②在庫を減らしやすい方向に売り買い注文の幅をずらす、のが基本的な考え方だそう。


### 部分約定対策 {#b2e1a6}

指値注文で一部のみ約定する場合があるのでこのハンドリング戦略. ポジションずれをどうリバランスするか.

部分約定, 一部約定は特に仮想通貨でつかわれていて一般的には[内出来]({{< relref "20220716193437.md#a7f59104-2004-4b5d-a33d-ef7fc950efce" >}})という用語の方が多い気がする. filled/remainingで表されるもの.

残ってしまった注文に対して注文内容を編集して更新(取引所によってAPIで１回で情報の編集更新がたり, キャンセルと再注文の2回のAPIの組み合わせで実現), または損切りする. 在庫管理の部分的な問題といえる.


### ロット数と並行トレード {#24d3da}

1つのbotのロットを上げるべきか, 複数のbotで小さいロットにするか問題.

-   [mmbotにおけるポジションと注文サイズについて - キジトラのブログ](https://kijitora-2018.hatenablog.com/entry/2018/12/23/102913)
-   [シストレにおけるポジション調整の数式表現について〜調整のアクティブ度合いによる式の変化〜 - マクロは3:2:5](https://sshuhei.com/entry/adjust_lot/)

---

以下Twitterサルベージ.

-   <https://twitter.com/AAAAisBraver/status/1034605157592395776>
    -   アンケートが参考になるかも. 0.01~0.1が25%.
-   <https://twitter.com/akagamiv2/status/1103130547537080320>
    -   AKAGAMIさんのツイート. 0.04~0.1くらい.

---

たくさん分割して在庫管理しながら指値している例.

<https://twitter.com/yanoteck/status/1357600266887917569>


### 損切り戦略 {#00c4e2}

[ストップリミット注文]({{< relref "20220716193437.md#b46d5510-e230-4d6e-adea-270a6c4c6cd4" >}})や[ストップロス注文]({{< relref "20220716193437.md#9f7c6ffd-4069-4a65-ad4e-e8e1ca3ac9ae" >}})をどうつかうか.

> ;; <https://twitter.com/javeleeer/status/1083654472046239744>
>
> mmbot、一定の閾値(評価損、lotなど)を超過したら成行で捨てる処理はナンセンスで許せないけど、在庫管理関数が指値注文にペナルティを乗せた結果、成行レートで約定してしまうのはスマートな実装に思える。あるとおもいます。

<!--quoteend-->

> ;; <https://twitter.com/blog_uki/status/1001333128093351938?lang=ja>
> こんにちわ。自分はstopは使っていません。stopで清算という概念ではなく、新しい指値が約定して自然とポジションを0に復元させる、という考え方でやっています。ポジションとは反対側の指値が約定しやすくしています。


## 用語整理 {#50fb86}

俗語解説.


### 雑成行 {#1b613c}

あまり損得考えずにえいやで価格をきめて成行で出してる人の注文を刈る.


## その他トピック {#88d1ce}

記事を読んで得たインサイトのブックマーク. 市場動向つねに変化しているため, 古い情報は今とは乖離があるかも.


### 2種類のmmbot {#b0006e}

-   取引指標が示す方向に指値を入れるbot.
-   スプレッドを意識してask/bidの両建てをするbot.

> ;; <https://twitter.com/asupega/status/1025777982273540098>
>
> mmbotと呼ばれるものにも2種類あって、uki氏のnoteにあったような、とにかく指標が示す方向に（成行になってもいいから）指値を入れ続けるタイプのbotと、スプレッドを意識してaskとbidの両方に入れ続けるbotがあるような気がしていて、後者が爆益してるような感じがするんですよね……


### 投資戦略の項目 {#889779}

<https://italiajin.com/marketmake/>

-   相場の勢い
-   在庫リスク
-   板の厚み
-   想定期間経過後の相場予測


### 高頻度取引の限界 {#71241834-e7d7-4075-8714-87659a971b0e}

ref. [100万円を1000万円にする取引戦略を考えてみる（主に取引回数と利回りの関係について） - マクロは3:2:5](https://sshuhei.com/entry/100to1000/)

> MMbotは複利運用が難しく，これから改良を続けても自分の能力と照らし合わせて考えて，おそらく日次50万程度が限界．取引手数料無料かつ，takerが多い環境でしか利益を上げづらい戦略なので，実質bitflyerFXでしか稼働が不可能．

[スナフキン]({{< relref "20220712161715.md#c472d9fe-aabf-4a20-84f7-ef5ab999f7b6" >}})

現在ではどうかわっているか?


### mmbot同士の戦いは熾烈なので、BTCJPYで今から勝つのはほぼ不可能 {#ed0e7b}

ref. [暗号通貨で勝てるのか？ 結論mmbotが唯一の可能性 | (`^・^`)猫にビットコイン](https://tokyo559.com/%E6%9A%97%E5%8F%B7%E9%80%9A%E8%B2%A8%E3%81%A7%E5%8B%9D%E3%81%A6%E3%82%8B%E3%81%AE%E3%81%8B%EF%BC%9F-%E7%B5%90%E8%AB%96%E3%80%80mmbot%E3%81%8C%E5%94%AF%E4%B8%80%E3%81%AE%E8%81%96%E6%9D%AF/)

> 結論高性能mmbotを作る。方法は人それぞれ、運用が肝。
>
> -   自分で作る。C++、JAVAなどコンパイル系言語による高速化は可能性あるかも
> -   作ってもらう（多分高額）

Javaの表記が間違っているしコンパイル言語出ないところが怪しいが, 高速化で差別化をはかるというインサイトは得た.

> 株取引は板のAPIは公開されていないと思うので、mmbotは運用できない。
>
> もし出来たらボロ儲けでしょう。

2022年は公開されている. [株取引API]({{< relref "20220714203637.md#540cb0dc-c01c-409b-abe4-5001ba8ef0ae" >}})


### 天下一BOT大会 {#a5f7a3ca-65ab-42e3-a6eb-2dd2e3f7912a}

2018年6月に行われたbotの収益を競うイベント.

[最強の仮想通貨自動売買botはどれだ！？第一回天下一BOT会（仮）開催！エントリー受付開始 | ALIS](https://alis.to/seville/articles/3gpe5pwL4vxn)

天下一BOT会でmmbotが驚異的な強さを発揮したとかで注目度アップ.

[「天下一BOT会」ドラゴンボールではなく仮想通貨自動売買ボット対決！ | 銭ナビ](https://number-x-value.com/2282.html)

第2回.

[「第二回天下一BOT会 令和元年記念大会」開催！今回はLiquidで | 銭ナビ](https://number-x-value.com/3778.html)


### 手数料について {#8fc27c}

mmbotでは買いと売りを両方注文するので手数料はそこも考慮. 理想的には手数料無料がいい.


### 一般人の成行注文を刈る {#638f92}

あなたの知らないbotの世界. 裁量トレーダーがbotのやっていることを知って驚くツイートをたまに見かける.


### 結局どこの取引所がいいのか問題 {#eec2f0}

bitFlyer全盛時代が2018年にあったようだが, そこから決定的なものはないのかな?


## References {#d95867}


### 理論 {#cf55fa}

-   [マーケットメイク戦略の理論 - これからの「お金」の話をしよう](https://we.love-profit.com/entry/2018/02/12/113916)
-   [高頻度botを雑に作るイメージ｜片道切符マン｜note](https://note.com/_and_go/n/nfa4f5672d65b?magazine_key=m411b4702af88)
-   [【bitFlyer - LightningFX】アルゴリズム高頻度取引mmbotの作り方，考え方，サンプルコード紹介-2021年1月最終更新｜mmbotxxx｜note](https://note.com/mmbot/n/n8e93128a23fb)
    -   無料は考え方のみ. サンプルコードは有料パート.


### 情報まとめ/やってみた {#b10e74}

初心者, またはこれからの情報.

-   [既存戦略調査 (1) mmbot｜j26｜note](https://note.com/j26/n/n396b5fb31663)
-   [HFTを作りたい｜さきやま｜note](https://note.com/sakiyama100/n/n20ef5a4c9549)
-   [mmbot神教材まとめ | ヤメティブログ](https://yameteeeee.com/mmbot_textbook/)
-   [mmbotとは何者か？ 天下一BOT会で圧勝してる短期高速スキャ系ボット流行の兆し | 銭ナビ](https://number-x-value.com/656.html)
-   bitbank
    -   [仮想通貨の自動取引入門 `環境構築`. 仮想通貨に限らず自動取引は取引時に人手を介さず、リスクのコントロールおよびリター… | by Yuya Sugano | Medium](https://yuyasugano.medium.com/%E4%BB%AE%E6%83%B3%E9%80%9A%E8%B2%A8%E3%81%AE%E8%87%AA%E5%8B%95%E5%8F%96%E5%BC%95%E5%85%A5%E9%96%80-%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89-99c1ca8f8b02)
    -   [仮想通貨の自動取引入門 `テクニカル指標`. 仮想通貨に限らず自動取引は取引時に人手を介さず、リスクをコントロールしつつコスト… | by Yuya Sugano | Medium](https://yuyasugano.medium.com/%E4%BB%AE%E6%83%B3%E9%80%9A%E8%B2%A8%E3%81%AE%E8%87%AA%E5%8B%95%E5%8F%96%E5%BC%95%E5%85%A5%E9%96%80-%E3%83%86%E3%82%AF%E3%83%8B%E3%82%AB%E3%83%AB%E6%8C%87%E6%A8%99-53b32f301ce6)
    -   [仮想通貨の自動取引入門 `Backtestingによるバックテスト` | by Yuya Sugano | Medium](https://yuyasugano.medium.com/%E4%BB%AE%E6%83%B3%E9%80%9A%E8%B2%A8%E3%81%AE%E8%87%AA%E5%8B%95%E5%8F%96%E5%BC%95%E5%85%A5%E9%96%80-backtesting%E3%81%AB%E3%82%88%E3%82%8B%E3%83%90%E3%83%83%E3%82%AF%E3%83%86%E3%82%B9%E3%83%88-22b243976a65)
    -   [仮想通貨の自動取引入門 `Pubnubによるマーケット・メイキング` | by Yuya Sugano | Medium](https://yuyasugano.medium.com/%E4%BB%AE%E6%83%B3%E9%80%9A%E8%B2%A8%E3%81%AE%E8%87%AA%E5%8B%95%E5%8F%96%E5%BC%95%E5%85%A5%E9%96%80-pubnub%E3%81%AB%E3%82%88%E3%82%8B%E3%83%9E%E3%83%BC%E3%82%B1%E3%83%83%E3%83%88-%E3%83%A1%E3%82%A4%E3%82%AD%E3%83%B3%E3%82%B0-df403abbe944)


### サンプルコードあり {#e16d0b}

-   [Python3 MarketMaker(MM)BOTのサンプルロジックとソースコード](https://note.com/magimagi1223/n/n5fba7501dcfd)
    -   written by [magito]({{< relref "20220712161715.md#2a5ebb06-8d80-4fea-8873-b12b56788cff" >}}).
    -   これはよく引用されている.
    -   [MarketMakerBOTのソースコード（by magito氏）読解メモ1](https://note.com/wanna_be_free/n/n5cba4f4a282d)
-   [pybottersとasyncioでmagito MM!｜pe｜note](https://note.com/clever_dahlia308/n/n2fdb1ca0c62e)
    -   <https://github.com/ko0hi/pybotters-magito-mm>
-   [mmbot作って動かしたけど勝てる気がしないので、コードを公開して一旦諦める](https://zenn.dev/dl10yr/articles/mmbot-zasetsu)
-   <https://github.com/BitMEX/sample-market-maker>
    -   BitMEXのGitHub repoにmmbot??
-   <https://github.com/ondra-novak/mmbot>
    -   GitHubのスターも100超えていて2022でも更新されている. C++製.


### 戦略/Tips {#8dd7c6}

ある程度取り組んだ視点からの解説記事. 基礎とサンプルからの改善.

-   [mmbotを何種類か作った時のメモ書き｜あかネス｜note](https://note.com/akaness_note/n/n3c816e051f8c)
-   [年間、仮想通貨自動売買BOTを作って思うこと。｜愚者の戦略｜note](https://note.com/memoran_yukiblog/n/nccb5a874005c)
-   [Liquid高頻度取引ボット構築の指南書｜Hoheto (仮想通貨botter)｜note](https://note.com/hht/n/n3c4765abac1c?magazine_key=m6ca0a3d216d3)
    -   途中までが無料なためヒントは得られる. 有料も評判良い.
-   片道切符マン
    -   [過去実施して増益に効果的だった施策、効果的ではなかった施策などなど①](https://note.com/_and_go/n/nf2450f6239fe)
    -   [過去実施して増益に効果的だった施策、効果的ではなかった施策などなど②](https://note.com/_and_go/n/nbfb3f687b67d)
