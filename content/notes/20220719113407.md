+++
title = "📝bitFlyer"
lastmod = 2022-08-14T07:24:34+09:00
tags = ["WIKI"]
draft = false
+++

up: [📝仮想通貨取引所]({{< relref "20220717152344.md" >}})


## bitFlyer Lighting FX {#3cdab5}

公式: [Lightning FX （ビットコイン FX）とは](https://lightning.bitflyer.com/About-Fx)

> Lightning FX とは、証拠金を預入れ、主に差金決済によるビットコインの売買が行えるサービスです。レバレッジをかけることにより資金効率の良い投資を行うことができます。

-   レバレッジ2倍.
-   最小発注量は0.01BTC.
-   取引所手数料は無料.
-   証拠金:
    -   レバレッジ2倍の場合は注文金額 x 50%.
    -   レバレッジ1倍の場合は注文金額のみ.

たとえば1BTCが30万だとすると. レバレッジ2倍では最小注文量0.01ということは15000円で注文をかけることができるわけだ.


## bitFlyer Futures FX {#5d4eaf}

取引量が少ない, 板が過疎通貨になってるよ.

-   最小発注数量は 0.001 BTC.


## 📝bitFlyer bot開発 {#a64be7e5-368e-44d6-9dc2-f685d7b30c8e}

bitFlyerを相手にしたbot開発の知見を貯める.

猫も杓子もHFTbotはbitflyer的なところがある.

-   bitFlyer Lighting FXが取引手数料無料(現物はお金かかる).
    -   ただし証拠金を予めいれておく必要がある.
-   最小ロット: 0.001BTC

概論はこっち[📝仮想通貨bot開発]({{< relref "20220717145220.md" >}}).


### 📝bitFlyer Lighting API {#becf06}

-   公式doc: <https://lightning.bitflyer.com/docs/api?lang=ja>


### libraries {#550d74}

-   <https://github.com/yagays/pybitflyer>
-   [pybotters](https://github.com/MtkN1/pybotters/blob/main/pybotters/models/bitflyer.py)
-   [ccxt](https://github.com/ccxt/ccxt/blob/master/python/ccxt/bitflyer.py)
    -   [bitFlyer ccxtライブラリ - Qiita](https://qiita.com/d_kvn/items/e38b9a21256fd38e65ba)


## <span class="org-todo todo _">✅</span> bitFlyer API Tips {#43c68b}


### 正常終了 {#a987e4}

status=200, parase-reason: OKとなるのでstatus=200で判断する.

post 系の場合, 正常終了するとbodyが空のことがあるので注意.


### <span class="org-todo todo _">💡</span> エラー時の振る舞い {#48f32a}

statusが200以外のときは, bodyに詳細情報が入っているので文字列JSONを解析して中身を取り出す.

status/error_message/dataの3種類の情報がある. statusはマイナスの数値でありhttp statusとは違うエラーコードなので注意.

---

エラーコード一覧, 拾い物.

ref. [[bitFlyer] エラーコード一覧【随時更新】｜ああああ｜note](https://note.com/17num/n/n6955c3a711a8)

```javascript
{"status": -1, "error_message": "Over API limit per minute", "data" :null}
{"status": -2, "error_message": "Under maintenance", "data" :null}
{"status": -100, "error_message": "Invalid product", "data": null}
{'status': -101, 'error_message': 'Invalid type of order', 'data': None}
{"status": -102, "error_message": "無効な売買コードです。", "data": null}
{"status": -103, "error_message": "価格は整数でご入力ください。", "data": null}
{"status": -104, "error_message": "Invalid order amount", "data": null}
{"status": -106, "error_message": "価格が低すぎます。", "data": null}
{"status": -107, "error_message": "The price is too high.", "data": null}
{'status': -111, 'error_message': 'Order not found', 'data': None}
{"status": -115, "error_message": "Not enough parameters.", "data": nil}
{"status": -121, "error_message": "利用規約に同意してください。", "data": null}
{"status": -122, "error_message": "Empty request body", "data": null}
{"status": -125, "error_message": "Invalid offset price.", "data": nil}
{'status': -153, 'error_message': '最低取引数量は 0.01 BTC です', 'data': None}
{"status": -156, "error_message": "Execution history is limited to the most recent 31 days.","data": null}
{"status": -200, "error_message": "Insufficient funds.", "data": null}
{'status': -203, 'error_message': '注文数の上限に達しています。', 'data': None}
{"status": -204, "error_message": "Market state is closed.", "data": null}
{'status': -205, 'error_message': '注文に必要な証拠金が不足しています。', 'data': None}
{"status": -208, "error_message": "Order is not accepted. Please try again later.", "data": null}
{'status': -500, 'error_message': 'Key not found', 'data': None}
{'status': -500, 'error_message': 'Invalid signature','data': None}
{'status': -500, 'error_message': 'Non-hexadecimal signature', 'data': None}
{'status': -501, 'error_message': 'タイムアウトしました。もう一度ログインしてください。', 'data': None}
{"status": -503, "error_message": "デモモードではご利用いただけません。", "data": null}
{'status': -508, 'error_message': '異常な発注があったため、注文を一定期間制限しています。', 'data': None}
{'status': -509, 'error_message': 'Your ordering has been limited due to submitting an irregular number of orders.', 'data': None}
```


### <span class="org-todo todo _">✅</span> 注文情報を修正/更新するには？ {#170a95}

edit_orderはない.

注文の修正はないので, キャンセルして再注文する.


### <span class="org-todo todo _">✅</span> 注文状況を確認するには？ {#113fb0}

新規注文を出すと, child-order-acceptance-idが帰ってる. このIDを元に状況取得のAPIを叩く(GET /v1/me/getchildorders).

```clojure
{:child-order-acceptance-id "JRF20220813-060xxx-0xxxxx"}
```


### <span class="org-todo todo _">💡</span> 執行数量条件とは {#4f4061}

執行数量条件は注文を出すときに指定できる(POST /me/vi/sendchildorder).

3種類の注文オプションが指定できる. postOnlyがない.

-   GTC: Good 'Til Canceled
-   IOC: Immediate or Cancel
-   FOK: Fill or Kill

ref. <https://lightning.bitflyer.com/docs/specialorder>


### <span class="org-todo todo _">💡</span> 親注文と子注文の違いは? {#7f7208}

注文オプションでロジックを指定した注文を発注すると, その注文を親注文(parent order)という. (POST /v1/me/sendparentorder)

注文種別は3種類ある.

-   IFD: [IFD注文]({{< relref "20220716193437.md#345e733a-7fce-4bc3-8c1a-9efa6e3ddd25" >}})
-   OCO: [OCO注文]({{< relref "20220716193437.md#c3cd4fc1-fe7f-4b72-87ac-7cfc6627cc4d" >}})
-   IFDOCO: [IFO注文]({{< relref "20220716193437.md#b26e6fd5-00a2-4599-90ff-0255fee908fb" >}})

ref. [🔗bitFlyer特殊注文](https://lightning.bitflyer.com/docs/specialorder)


### <span class="org-todo todo _">💡</span> child-order-idとchild-order-acceptance-idの違いは? {#6dd484}

```clojure
{:child-order-id             "JFX20220813-074643-xxxxxxF"
 :child-order-acceptance-id  "JRF20220813-074643-xxxxxx"}
```

決定的な資料がないので以下は推測.

child-order-acceptance-idはAPIで注文を出したときに即時に帰ってくるID. これを利用してAPIではその後の処理ができる(ステータス取得/注文キャンセル).

child-order-idは注文を出したAPIとは別に情報取得APIで注文状況を取りに行ったときに現れる(/me/v1/getchildorders). また画面表示で表示されるのもchild-order-idであり, child-order-acceptacne-idは表示されない.

おそらく即時レスポンスのために発行される一時的なもと, その後システムでいろいろ処理したあとに付与されるIDがあり, なぜそうなっているのかはシステムの設計の話でよくわからない. ただしclientから注文を操作する場合, child-acceptance-idを覚えておけば困ることはないのでこれを一意のIDで扱っていい.

---

Twitterで検索をかけると, responseにchild-order-acceptance-idがないケースや{buf,sell}_child_order_acceptance_idが約低履歴に現れるなど, よくわからない仕様.

<https://twitter.com/search?q=child_order_acceptance_id&src=typed_query&f=live>

バグなのか? よくわからずにけっこうみんな悩んでいる.


### 約低情報遅延と板自炊対策 {#cfff61}

websocket経由の約定情報取得がたまに3-5sec遅延する. しかしだいたい1sec以内には配信される.

-   [[Python Websocket JSON-RPC OHLCV] bitFlyer の約定情報の遅延計測結果｜ああああ｜note](https://note.com/17num/n/nd2d6017c1dca)

これに対してtick情報から板情報をローカルに構築してそれで約定判断をするアプローチがある.

-   [ポジション自炊して高速に売買を行うBitFlyerでの高速botフレームワーク｜くもすけ｜note](https://note.com/kunmosky1/n/n6496da8285c0)

部分約定も再現できるとか.

-   <https://twitter.com/regolith1223/status/1092372320247734275>


## bitFlyer評判まとめ {#d061b8}
