+++
title = "📝Clojure Idioms"
tags = ["WIKI"]
draft = false
+++

refs: [📂Clojure Core]({{< relref "20220112142936.md" >}}) [🏷Clojure]({{< relref "20211111225741.md" >}})

Clojureの主にデータ操作に関する小技を書き溜めていく.

Ankiに突っ込むことで記憶もしていく.


## andとorを条件分岐につかう {#andとorを条件分岐につかう}

-   orに当たらえれた式で真になるものが見つかったら残りを評価せずに真を返す.
    -   ex. [yogthos/config](https://github.com/yogthos/config/blob/81750c8fdb946050a8074f14ab03c8b226536b1a/src/config/core.clj#L57)
-   andに当たらえれた式で偽になるものが見つからない限り残りを評価する.

ref: [📚Land of Lisp]({{< relref "20211113235959.md" >}}) p47に書いてあった.


## ネストしたCollection操作にget-in/assoc-in/update-in {#ネストしたcollection操作にget-in-assoc-in-update-in}

get-in/assoc-in/update-in をつかう.

<https://clojuredocs.org/clojure.core/assoc-in>

```clojure
;; assoc-in into a nested map structure
(def foo {:user {:bar "baz"}})
(assoc-in foo [:user :id] "some-id")
;;=> {:user {:bar "baz", :id "some-id"}}
```

ref: [📝Clojure Map(clojure.core.map)]({{< relref "20220116080205.md#clojure-map--clojure-dot-core-dot-map" >}})


## 関数の引数にデフォルト値を指定するには？ {#関数の引数にデフォルト値を指定するには}

いわゆるデフォルト引数というものだが,
位置引数に値を設定する方法は見当たらない(見つけられてないだけかも).

代わりにオプション引数と [キーワード引数]({{< relref "20220305075933.md#関数の引数" >}}) の文法の組み合わせでできる.

[分配束縛(Destructuring)]({{< relref "20220116094551.md#clojure-分配束縛--destructuring" >}}) の **or** を活用する.

```clojure
(defn myfunc
  [arg & {:keys [opt1 opt2] :or {opt1 "default1" opt2 "default2"}}]
  (format "arg=[%s] opt1=[%s] opt2=[%s]" arg opt1 opt2))

(myfunc "argument" {:opt1 "option1"})
;; => "arg=[argument] opt1=[option1] opt2=[default2]"
```


## select-keys: あるMapからkeywordを指定してSubMapを作成 {#select-keys-あるmapからkeywordを指定してsubmapを作成}

<https://clojuredocs.org/clojure.core/select-keys>

```clojure
(select-keys {:a 1 :b 2} [:a])
;;=> {:a 1}
```


## fnil: Nilを 初期値で置き換えて関数適用 {#fnil-nilを-初期値で置き換えて関数適用}

<https://clojuredocs.org/clojure.core/fnil>

データ操作をしようとしたときに,
引数でもらったデータ構造がnilの場合は初期値のデータ構造で置き換える.

```clojure
(update request ::acc (fnil conj []) id)
```

これのやろうとしていることは,
request mapの ::accというフィールドにあるvectorにidを追加しようとするが,
:acc がrequest mapにないときは空のvectorを用意してさらにidを加える.


## References {#references}

-   [イディオム集 — Clojure の日本語ガイド](https://ayato-p.github.io/clojure-beginner/idioms/index.html)
-   [1ヶ月間仕事でClojureを書いている今時点でよく使う関数・コマンドまとめ - Qiita](https://qiita.com/makinoshi/items/a4393784b9532d6a9f22)
-   [filter と remove のふたつの結果を簡単に受け取る方法 - Qiita](https://qiita.com/ayato_p/items/db4d6bd8d453f14e13e2)
-   [Clojure Destructuring Tutorial and Cheat Sheet · GitHub](https://gist.github.com/john2x/e1dca953548bfdfb9844)
