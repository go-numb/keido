+++
title = "📝Clojure Product Development"
tags = ["WIKI"]
draft = false
+++

up: [📂Clojure Development]({{< relref "20220211141917.md" >}}) tags: [🏷Clojure]({{< relref "20211111225741.md" >}})

Clojureプロダクト開発で役立つライブラリとフレームワークまとめ.

必要に応じてトピックごとにリファクタリングすること.

-   refs:
    -   [📝Clojure Web Development]({{< relref "20220118092453.md" >}}) => Web関係はこっち
    -   [📝Clojure API Client Development]({{< relref "20220209102028.md" >}}) => Client API関係はこっち
    -   [📝Clojure Style Rules & Conventions]({{< relref "20220313110515.md" >}}) => コーディング規約や慣習はこっち
    -   [📝Clojure Architecture]({{< relref "20220314120812.md" >}}) => 設計周り


## Clojure: Backend Framework {#697917}


### Clojure: Duct {#d8c00c56-21de-485d-af41-01f920cd7c7f}

-   <https://github.com/duct-framework>
    -   <https://github.com/duct-framework/core>

[Integrant]({{< relref "20220531084041.md" >}}) をベースにした拡張機能を提供(作者が同じ).
Webフレームワークではなくもっと汎用的なもの.

-   [Ductモジュール入門](https://www.slideshare.net/KentOhashi/duct-module-getting-started)
-   [はじめてのDuct - Uzabase for Engineers](https://tech.uzabase.com/entry/2018/04/03/115236)
-   [Document how to use duct with tools.deps - GitHub](https://github.com/duct-framework/duct/issues/92)


#### <span class="org-todo todo _">💡</span> Javaからのアナロジー {#455157}

小さな構成のシステムをJavaで作成するならモジュールごとにクラス分割するが,
Ductはクラスに初期化データとその方法を定義するためのコンストラクタを定義するようなものか?
責務を意識したクラス設計とはドメイン分割.


### Clojure: Roll {#21f47f3d-586b-4b9b-a42a-b5cc9d04b913}

<https://github.com/dimovich/roll>

backend for Clojure. Ductよりもさらにシンプル, integrantがベース.


## Clojure: 状態管理とシステム {#19f383}

いろいろあるがナウいのはIntegrantかな？

-   [stuartsierra/component](https://github.com/stuartsierra/component)
-   [tolitius/mount](https://github.com/tolitius/mount)
-   [weavejester/integrant](https://github.com/weavejester/integrant/projects?type=beta)
    -   [📝Clojure Integrant]({{< relref "20220531084041.md" >}})

状態管理ライブラリとは関数型パラダイム固有のものかな？ Redux的な.


### Clojure: Component {#df5f054f-57e7-441a-a196-f65bb8b478fb}

[Stuart Sierra]({{< relref "20220320182327.md" >}}) 作.


### そもそもシステムとコンポーネントとは {#284f08}

システムはそもそもアプリケーションが長い間起動しているときに必要となる考え. スクリプトやユーティリティの実行では必要ないのだ. それらは処理の終了がプログラムの終了でありリソースの開放である.

バックグラウンド実行をし続ける部分で構成されるアプリケーション, その部分が依存関係にあり初期化時に関係を構築するもの, これがシステム.

システム構築する部品=コンポーネントは単純化すれば, On/Offの操作によるStatefulなObjectである.

ref: [Systems in Clojure](https://grishaev.me/en/clj-book-systems/)


## Clojure: ロギング(Logging) {#fc3521e8-72f6-4416-83b2-067344374a9a}

Javaの資産を使うか否かが採用のポイントかな？Javaのロギングライブラリは歴史がある.

timbreはpure clojureではあるが, やはり設定例やノウハウがGoogle検索で見つかるのは, Javaライブラリが多い(logback).


### clojure.tools.logging {#72b25d3f-8637-4735-960b-c44af8418aa2}

clojure tools.logging libaryでJavaの資産を活用.

-   official docs
    -   <https://github.com/clojure/tools.logging>
    -   <https://clojure.github.io/tools.logging/>

---

-   ref:
    -   [🖊Logbackのログを見やすくする方法(ファイルをgrep, Lilith) | Futurismo](https://futurismo.biz/archives/6825/)
    -   [Quickly Set up Clojure Logging with the Right Library](https://spin.atomicobject.com/2015/05/11/clojure-logging/)
    -   [Clojure Log Configuration](https://www.solasistim.net/posts/clojure_log_configuration/)
    -   <https://github.com/pyr/unilog>
        -   clojure.tools.logging拡張?


### Clojure: timbre {#c0af56ee-9d64-4846-9b1b-3f49881a3801}

Pure Clojure/Script logging library.

[GitHub - ptaoussanis/timbre: Pure Clojure/Script logging library](https://github.com/ptaoussanis/timbre)

[slf4j-timbre](https://github.com/fzakaria/slf4j-timbre) をつかうとJavaのロギングライブラリと連携可能.

日本の時刻設定例:

```clojure
(def timbre-config
  {:timestamp-opts
   {:pattern  "yyyy-MM-dd HH:mm:ss,SSS"
    :locale   (java.util.Locale. "ja_JP")
    :tiemzone (java.util.TimeZone/getTimeZone "Asia/Tokyo")}})
(timbre/merge-config! timbre-config)
```

また現実的な問題点として, timbreはpure clojureではあるものの, 3rd party libraryがjavaのライブラリに依存していると,その制御をtimbreからはできない(Javaから独立していることが利点なので). そのため結局 logback.xmlを書かないといけないかもしれない.

<https://github.com/ptaoussanis/timbre/issues/138>

(なんかcider-nreplとの相性なのか CIDEE環境でerrorが動作しない. これはstderrの扱いかもしれない).


### <span class="org-todo todo _">💡</span> tips: Jetty サーバのログを黙らせる {#3f41ba}

jetty serverを起動したりclj-httpを使うとREPLを侵食する問題.

以下はlogback.xmlを設定する例.

-   [Pedestalのデバッグログがうるさいので、静かにした - ayato-p](https://scrapbox.io/ayato-p/Pedestal%E3%81%AE%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%83%AD%E3%82%B0%E3%81%8C%E3%81%86%E3%82%8B%E3%81%95%E3%81%84%E3%81%AE%E3%81%A7%E3%80%81%E9%9D%99%E3%81%8B%E3%81%AB%E3%81%97%E3%81%9F)
    -   <https://twitter.com/_ayato_p/status/1115059001459335168>
-   [Basic logging in Clojure web service not appearing on console - Stack Overflow](https://stackoverflow.com/questions/31371993/basic-logging-in-clojure-web-service-not-appearing-on-console)

timbre

-   [Noisy Netty logs show up after adopting this library · Issue #32 · fzakaria/slf4j-timbre · GitHub](https://github.com/fzakaria/slf4j-timbre/issues/32)


## References {#d95867}

-   [The Clojure Toolbox](https://www.clojure-toolbox.com/)
    -   逆引きのClojure Libraryまとめページ.
