+++
title = "📝Clojure API Client Development"
tags = ["WIKI"]
draft = false
+++

主にサービスのAPIを叩くクライアントプログラムのノウハウまとめ.

ref: [📝Clojure Web Development]({{< relref "20220118092453.md" >}}) から分離.

up: [📂Clojure]({{< relref "20220214041907.md" >}}) tags: [🏷Clojure]({{< relref "20211111225741.md" >}}) refs: [📝Clojure with Twitter Development]({{< relref "20220307193727.md" >}})


## Clojure HTTP Client {#clojure-http-client}

主なクライアントライブラリにhttp-kitとclj-httpがある.

-   <https://github.com/http-kit/http-kit>
-   <https://github.com/dakrone/clj-http>

httpリクエストに関してはどちらも同じことができる. 非同期発行も.

ただしポイントはwebsocketがt統合されているかどうか.

http-kitは2022年現在メンテナンス状況が怪しく見えた.


## clj-http {#clj-http}

<https://github.com/dakrone/clj-http>

[Ring]({{< relref "20220118092453.md#clojure-ring-webサーバ抽象" >}}) の影響を受けているため Request Mapを入力としてResponse Mapを返す.


### tips: debug 出力 {#tips-debug-出力}

{:debug true} をRequest Mapに含めると, 標準出力にRequest Mapの内容が表示される.


### tips: clj-httpにおけるjsonの扱い {#tips-clj-httpにおけるjsonの扱い}

ClojureでJSONを扱うライブラリである [darkrone/cheshire](https://github.com/dakrone/cheshire) をインストールすると, json
との連携がキーワードでできる.

-   {:accept :json} で application/jsonをcontent-typeに設定.
-   {:as :json} で response mapのbodyをjsonとしてパース.

ただ実験すると :as は :acceptを兼ねるようなので :asだけつければいいのか？


### howto: clj-httpのリクエストをproxy経由にするには？ {#howto-clj-httpのリクエストをproxy経由にするには}

Request Mapに proxy-host, prox-port, proxy-user, proxy-passを含める.

ref: [clj-http: Proxies](https://github.com/dakrone/clj-http#proxies)


### howto: clj-httpで WARN log: Invalid 'expires' attribute {#howto-clj-httpで-warn-log-invalid-expires-attribute}

request mapのオプションに **:cookie-policy :standard** を追加.

ref: [Invalid 'expires' attribute? - GitHub](https://github.com/dakrone/clj-http/issues/325)


## References {#references}

勉強の参考に目を通したもののブックマーク.

-   [ClojureでQiita APIをたたく - Qiita](https://qiita.com/akthrms/items/42af315089229800aefa)
    -   <https://github.com/akthrms/qiita-client-sample>
    -   Qiitaを叩くだけだけど余計なものがないのでよい.
-   [Clojure tutorial - boot, basic functions and how to do REST requests](https://joaoptrindade.com/clojure-tutorial-part-1-http-requests)
    -   とくにClojureのREST requestsに着目したチュートリアルWeb記事.
    -   example of clj-http
    -   <https://github.com/joninvski/clojure-tutorial>
