+++
title = "📝Org-mode"
tags = ["TAG", "Emacs", "WIKI"]
draft = false
+++

## Org-modeとは {#org-modeとは}

プレーンテキストの記法の一つ.

オーグモードと読み, Org-modeと表記するのが正式.

個人的にはEmacsのキラーアプリ的存在. ほかのエディタにOrg-modeが実装されたら移行してもいいがそうでなければEmacsを離れられない.


## Org-mode基本用語 {#org-mode基本用語}

-   エントリ
    -   アスタリスクで始まる項目全体.
-   見出し(headline)
    -   エントリのアスタリスク行
-   ツリー(tree)
    -   一つのエントリとその配下のエントリ全体.
-   サブツリー(subtree)
    -   一つのエントリにつながるエントリ.


## エントリ移動関連 {#エントリ移動関連}


### org-archive {#org-archive}

M-x org-archive-location(C-c C-x C-a)でエントリをアーカイブできる.

アーカイブ先のファイルは今のファイル名に .org_archiveという名前で新規作成されて保存される.


### org-refile {#org-refile}

org-refile (C-c C-w) でorg-modeのエントリー(サブツリー)を他の場所へ移動できる.

デフォルトだとカレントバッファ内の第1レベルのエントリ内に移動できる. 移動先の候補は org-refile-targets 変数で変更できる.

```emacs-lisp
(setq org-refile-targets '((org-agenda-files :maxlevel . 3)))
```

org-agendaの設定を書くのがよく見る例. 個別フォルダ配下のファイルを設定したいときは, [.dir-locales.el]({{< relref "20220112095806.md#ディレクトリーごとにローカル変数を適用するには-dot-dir-locales-dot-el" >}}) を使う方法がある.

[Doom Emacs]({{< relref "20220602081612.md" >}}) だと +org/refile-xxx という関数でrefileが便利に拡張されている.

ref. [指定した任意のorgファイルへエントリー(サブツリー)を移動する方法](https://misohena.jp/blog/2021-07-17-org-refile-entry-to-specified-file.html)


#### fileのコンテンツをすべて別のファイルのサブツリーに移動する {#fileのコンテンツをすべて別のファイルのサブツリーに移動する}

Doom Emacsの+org/refile-to-fileを利用する. まずファイルの先頭にbulletをいれることでファイルの中身すべてを一つのアイテムにする. そのあと+org/refile-to-fileを発動させればOk.


### org-cut-subtree {#org-cut-subtree}

エントリのサブツリーをカット. org-refileの代わりにこっちで手動カット&ペーストもあり. org-speed-commandではkで発動.


### org-narrow-to-subtree/widen {#org-narrow-to-subtree-widen}

M-x org-narrow-to-subtreeで移動ではないがfileに移動したかのように subtreeだけを表示させる. 戻すときは M-x widen.

Doom Emacsだと C-x n sでnarrow/C-x n wでwiden. [org-speed-command](#org-speed-command)だとsで発動. 戻すとき(widen)もsで.


## org-capture {#org-capture}

アイデアを素早くorg-modeのノートにメモするための機能.


### howto: Google Chomeの閲覧内容をorg-captureするには? {#howto-google-chomeの閲覧内容をorg-captureするには}

[org-protocol](https://orgmode.org/worg/org-contrib/org-protocol.html) と [Chrome ExtentionのOrg Capture](https://chrome.google.com/webstore/detail/org-capture/kkkjlfejijcjgjllecmnejhogpbcigdc) を利用する.

仕組みとしては，Chromeにインストールした拡張機能がorg-protocolというMIME type(アプリケーションを識別する体系)を発行するので，それをemacsclientで受け取って処理をする.

具体的にはemacslicentのデスクトップアプリケーションを作成して，org-protocolを処理するデフォルトアプリケーションでそのアプリケーションを指定.


#### Manjaro Linuxの例(xfce) {#manjaro-linuxの例--xfce}

~/.local/share/applications/emacsclient.desktop作成

```text
[Desktop Entry]
Name=Emacsclient
Exec=emacsclient %u
Icon=emacs
Type=Application
Terminal=false
MimeType=x-scheme-handler/org-protocol
```

~/.config/mimeapps.listに  x-scheme-handler/org-protocol=emacsclient.desktop を追記.

update-desktop-databbaseをコマンドラインから実行.

org-captureの設定例.

```emacs-lisp
("p" "browser" entry (file "~/gtd/inbox/inbox.org")
 "* %^{Title}\nSource: %u, %c\n #+BEGIN_QUOTE\n%:initial\n#+END_QUOTE\n\n\n%?")
("L" "browser link" entry (file "~/gtd/inbox/inbox.org")
 "* %? [[%:link][%:description]] \nCaptured On: %U")
```

ポイントはorg-captureのトリガキーをpとLにすること.これはorg-capture-extensionなのでこれを守らないと動かない.もしくは自分でブックマークレットを作成する.

-   refs.
    -   [Org-Protocol](https://jingsi.space/post/2017/04/30/org-protocol/)
    -   [XDG MIME Applications - ArchWiki](https://wiki.archlinux.org/title/XDG_MIME_Applications#fromHistory)
    -   <https://github.com/sprig/org-capture-extension>


## org-babel(ob) {#org-babel--ob}

[🏷Literate Programming]({{< relref "20220318202503.md" >}})

org-mode内にコードを埋め込み実行する.


### ob-restclient {#ob-restclient}

org-modeのファイル上でREST clientをインタラクティブに操作できる.

-   <https://github.com/pashky/restclient.el>
-   <https://github.com/alf/ob-restclient.el>

ある意味最強のREST Client.

うかつに実行したら戻ってきたらが大量のデータた場合にEmacsがハングする.

-   ":results none" で 出力抑止.
-   ":results output silent" で minibufferのみに出力.


### 🔗References {#references}

-   [🔗Web操作手順書を自動生成！Emacs org-babelで実現するRun Book Automation(RBA) | Futurismo](https://futurismo.biz/archives/2451/)
-   [🔗org-babel と R の組み合わせがとても心地よい件 | Futurismo](https://futurismo.biz/archives/2907/)


## org-speed-command {#org-speed-command}

Org-modeの操作を高速化するOrg-mode(隠し標準？)機能.

なれるまではM-x org-speed-command-helpで使い方確認.

ref. [org-mode のキーバインド、その先 - Qiita](https://qiita.com/takaxp/items/a5a3383d7358c58240d0)

-   n: 下のアウトライン
-   p: 上のアウトライン
-   f: 下のアウトライン
-   b: 上のアウトライン
-   u: 上位のアウトライン


## org-table {#org-table}


### Orgテーブルをcsv出力する {#orgテーブルをcsv出力する}

標準関数の org-table-exportをつかう. カーソル位置のテーブルをファイルに出力できる.

org-table-export-default-format のデフォルト値は orgtbl-to-tsv なのでorgtbl-to-csvを設定.

itemのプロパティに設定できる.

```text
\* Section with table
:PROPERTIES:
:TABLE_EXPORT_FILE: data/observations.csv
:TABLE_EXPORT_FORMAT: orgtbl-to-csv
:END:

| day              | observation |
|------------------+-------------|
| <2019-11-14 Thu> | cold        |
| <2019-11-14 Thu> | warm        |
```


## org-journal {#org-journal}

org-modeで日誌を書くことに特化した拡張.

ref. [bastibe/org-journal: A simple org-mode based journaling mode](https://github.com/bastibe/org-journal)

**org-search-forever** で過去の日記からキーワード検索.


## Org-mode FAQ {#org-mode-faq}


### タイムスタンプ(timestamp)の []と<>の違い {#タイムスタンプ--timestamp--の-と-の違い}

基本的には<>をつかう. []をつかうとorg-agendaに表示されなくなる.

Org-captureでは %Uで[], %Tで<>の形式でtimestampが作成される.


## org-mode HOWTO/Tips {#org-mode-howto-tips}

org-modeはなんでもできるので，けっこうヘルプに該当する設定を探すのもタイヘンなのでここに逆引きヘルプをメモしていく.


### ✅Org-modeのヘルプをEmacsから引くには？ {#org-modeのヘルプをemacsから引くには}

後で調べる.


### ✅Org-modeの表示がなんかへんなのを１発で直す方法 {#org-modeの表示がなんかへんなのを１発で直す方法}

たまにバグるのかツリー構造のパースができてないのか表示がおかしくなる.

M-x org-mode-restartでorg-modeを当て直すと一発で直る.

もしくは謎のmajor-modeでorg-modeが効いてない場合もあるのでM-x org-modeでモードをあて直す.


### ✅ファイルを開いたときのデフォルトの見出し階層を設定するには？ {#ファイルを開いたときのデフォルトの見出し階層を設定するには}

変数で全体的な設定をするほうほうとファイル先頭に個別に設定する方法がある.

org-startup-folded変数にパラメータを設定する.

```emacs-lisp
(setq org-startup-folded nil)
```

```text
nofold           全見せ(初期値)
fold             最上位の見出しのみ
content          見出しのみ全見せ(引き出し内側は隠す)
show everything  全見せ(引き出しの内側も表示)
```

もしくはfileのメタデータに #+STARTUP: を書く.

```text
#+STARTUP: overview 最上位の見出しのみ(=fold)
#+STARTUP: content見出し全部見せ(= nofold)
#+STARTUP: showall 全見せ
#+STARTUP: show2levels
#+STARTUP: show3levels
#+STARTUP: show4levels
#+STARTUP: show5levels
#+STARTUP: showeverything
```

showallだとbulletのpropertiesは隠れるが, showeverythingだとpropertiesが開く.

---

-   refs.
    -   [Initial visibility (The Org Manual)](https://orgmode.org/manual/Initial-visibility.html)
    -   [org-modeのファイルを開いた時の挙動が変わっていた](https://note.com/5mingame2/n/nfb69499996d3)
        -   org-mode v9.4から挙動が変わったとのこと.


### <span class="org-todo todo _">✅</span> Org-mode形式をlive previewするには？ {#org-mode形式をlive-previewするには}

org-exportでHTMLにエクスポートしてWebブラウザで見る.

これを自動化するpackageとして[jakebox/org-preview-html](https://github.com/jakebox/org-preview-html/)がある.


### <span class="org-todo todo _">✅</span> テキストの装飾(Formatting)をかんたんにするには？ {#テキストの装飾--formatting--をかんたんにするには}

M-x org-emphasize(C-c C-x C-f) で選択できる.

-   **test** Bold
-   _test_ Itaric
-   <span class="underline">test</span> Underline
-   ~~test~~ Delete
-   `text` Code
-   `text` Smale


## References {#references}

-   up: [🏷Emacs]({{< relref "20220112095806.md" >}})
-   refs.
    -   [✅Org-modeをマインドマップにexportするには？]({{< relref "20220628200656.md" >}})
    -   [✅Org-modeをグロースハックにつかうには?]({{< relref "20220713201501.md" >}})
    -   [✅Org-modeをGTDにつかうには?]({{< relref "20220804103024.md" >}})
    -   [📝Org-roam]({{< relref "20211204183600.md" >}})
    -   [📝ox-hugo]({{< relref "20211231044406.md" >}})
